<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynapseNet Systems Private Limited | Bulk WhatsApp Message App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <link href="./style.css" rel="stylesheet">
    
        <style>
            .icon-container{
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .icon-box {
              display: inline-block;
              padding: 16px;
              background-color: #e9ecef; /* Grey color */
              border-radius: 16px;
            }
            .icon-link{
              color: black;
              margin-left:auto;
              margin-right: auto;

            }
            .radio-container {
                display: none;
            }

            .radio-container.active {
                display: block;
            }

          </style>
        
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">SynapseNet Systems</a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#settingsModal">
                            <i class="fa fa-cog"></i> 
                            Settings
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-3">
        <div class="row">
            <label for="templateDropdown" class="col-md-3 col-form-label">Select a Template:</label>
            <div class="col-md-3 d-flex">
                <select id="templateDropdown" class="form-select"></select>
                <mark><div id="languageDisplay" class="language-display"></div></mark>
                
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-8">
                <div class="card  mt-5">
                    <header class="card-header">
                        <h4 class="mb-0">WhatsApp Message Form</h4>
                    </header>
                    <div class="card-body">
                        <form id="messageForm">
                            <!-- <div class="mb-3">
                                <label for="bodyImage" class="form-label">Image/Video</label>
                                <input class="form-control" type="file" id="bodyImage">
                            </div> -->
                            <div class="mb-3">
                                <label for="selectMediaType">Media type</label>
                                <select class="form-select form-select-md mb-3" id="selectMediaType">
                                    <option value="text" selected>Text</option>
                                    <option value="multimedia">Multimedia</option>
                                </select>

                                <div id="multimedia-options" class="radio-container">
                                <div class="form-check form-check-inline ml-auto mr-auto">
                                    <input class="form-check-input" type="radio" name="multimedia-option" id="imageRadio" value="image" >
                                    <label class="form-check-label" for="imageRadio">
                                        <svg class="icon-box" xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                                    </label>
                                  </div>
                                  <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="multimedia-option" id="videoRadio" value="video" >
                                    <label class="form-check-label" for="videoRadio">
                                        <svg class="icon-box" xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-video"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                                    </label>
                                  </div>
                                  <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="multimedia-option" id="documentRadio" value="document">
                                    <label class="form-check-label" for="documentRadio">
                                        <svg class="icon-box" xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                    </label>
                                  </div>
                                  <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="multimedia-option" id="audioRadio" value="audio">
                                    <label class="form-check-label" for="audioRadio">
                                        <svg class="icon-box" xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-headphones"><path d="M3 18v-6a9 9 0 0 1 18 0v6"></path><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path></svg>
                                    </label>
                                  </div>
                                </div>
                                    <div class="row" >
                                        <div class="d-none" id="mediaComponent">
                                            <div class="card mt-5">
                                                <div class="card-header">
                                                    <h6 class="mb-0">Multimedia Upload</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <div class="input-group">
                                                            <div class="mb-3">
                                                                <label for="mediaFile" class="form-label">Upload <mark class="font-weight-bold inline" id="uploadType">sasas</mark> File</label>
                                                                <input class="form-control" type="file" id="mediaFile">
                                                              </div>
                                                              
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- End of Bootstrap Card Component -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            

                            <div class="mb-3">
                                <label for="bodyText" class="form-label">Body text</label>
                                <textarea rows="10" id="bodyText" class="form-control" placeholder="Body"></textarea>
                            </div>
                            <div class="mb-3">
                                <button id="sendMessage" class="btn btn-primary">Send message</button>
                            </div>
                        </form>
                    </div>
                    <div id="response" class="card-footer d-none alert alert-primary" role="alert">
                    </div>
                </div>
            
                <div class="col-4">
                    <div class="card mt-5">
                        <header class="card-header">
                            <h4 class="mb-0">Preview</h4>
                        </header>
                        <div class="card-body" id="preview">
                            <div class="bubble bubble-bottom-left">
    
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalLabel">Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="cloudApiToken" class="form-label">CLOUD_API_ACCESS_TOKEN:</label>
                        <input type="text" class="form-control" id="cloudApiToken">
                    </div>
                    <div class="mb-3">
                        <label for="waPhoneNumber" class="form-label">WA_PHONE_NUMBER_ID:</label>
                        <input type="text" class="form-control" id="waPhoneNumber">
                    </div>
                    <div class="mb-3">
                        <label for="waPhoneNumber" class="form-label">GOOGLE_SHEET_ID:</label>
                        <input type="text" class="form-control" id="sheetId">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveChanges">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Get references to elements
        
        document.getElementById('bodyText').addEventListener('input', function () {
            let bodyText = this.value.replace(/\s{2,}/g, ' ');
            document.getElementById('preview').innerHTML = '<div class="bubble bubble-bottom-left">' + bodyText + '</div>';
        });

        document.addEventListener("DOMContentLoaded", function () {
            fetchTemplateNames()
        })

        document.getElementById("saveChanges").addEventListener('click', function () {
            var cloudApiToken = document.getElementById("cloudApiToken").value;
            var waPhoneNumber = document.getElementById("waPhoneNumber").value;
            var sheetId = document.getElementById("sheetId").value;

            var config = {
            "cloud_api_access_token": cloudApiToken,
            "wa_phone_number_id":waPhoneNumber,
            "google_sheet_id": sheetId
            }

            updateConfigFile(config)

        })

        document.getElementById('templateDropdown').addEventListener('change', function () {
            var selectedTemplateName = this.value;
            var selectedTemplate = templates.find(template => template.name === selectedTemplateName);
            var languageDisplay = document.getElementById('languageDisplay');
            languageDisplay.textContent = selectedTemplate.language;
            languageDisplay.style.display = 'block';
        });

        function updateConfigFile(config){
            const response=axios.post('http://localhost:3002/update-config', config)
        }

        function fetchTemplateNames() {
            axios.get('https://graph.facebook.com/v19.0/245132928672654/message_templates', {
            headers: {
                'Authorization': 'Bearer EAAKqoj5ZBBJ0BO3ZAOqwHB3ZAcZAyoRfLBoKLNKRJsn5OJ6Y2H0QI1LfJK9jl25nWT7HFj29AD3bA0fYQpgZCwMJ52hRpjgAMZAG4ri7T79ZCkYfzTXVDkPiYJcgKDPDonbsXpAjgaIZCGAsnUWpZB2qU7Yctm7JQTmoHYhsvuUstDUtO0VT7LZCwzm4Bntn9UoOd8FxKPrXKSPsMqynqvoj2lC38ZCZANkZD'
            }
        }).then(function (response) {
            const templateDropdown = document.getElementById('templateDropdown');
            templates = response.data.data;
            templates.forEach(template => {
                const option = document.createElement('option');
                option.value = template.name;
                option.text = template.name;
                templateDropdown.add(option);
            });
        }).catch(function (error) {
            console.error('Error fetching templates:', error);
        });}
      </script>
    
</body>

</html>